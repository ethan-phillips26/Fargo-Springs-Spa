@page "/contact"

@using System.ComponentModel.DataAnnotations
@using FargoSpringsSpa.Data
@using FargoSpringsSpa.Models
@using Microsoft.EntityFrameworkCore
@inject IDbContextFactory<FargoSpringsSpaContext> DbFactory
@rendermode InteractiveServer

<PageTitle>Contact - Fargo Springs Spa</PageTitle>

<link href="css/contact.css" rel="stylesheet" />

<div class="container my-5">
    <h2 class="text-center mb-5">Contact Us!</h2>

    <div class="d-flex flex-column gap-4 mb-5">
        <div class="contact-pill d-flex align-items-center p-3 shadow-sm">
            <img src="images/profile1.jpg" class="profile-img me-3" alt="Jane Smith" />
            <div>
                <h5 class="mb-1">Jane Smith</h5>
                <p class="mb-0 text-muted">Front Desk Manager</p>
                <p class="mb-0"><strong>Email:</strong> jane@fargospringsspa.com</p>
            </div>
        </div>

        <div class="contact-pill d-flex align-items-center p-3 shadow-sm">
            <img src="images/profile2.jpg" class="profile-img me-3" alt="Carla Ruiz" />
            <div>
                <h5 class="mb-1">Carla Ruiz</h5>
                <p class="mb-0 text-muted">Massage Therapist</p>
                <p class="mb-0"><strong>Email:</strong> carla@fargospringsspa.com</p>
            </div>
        </div>

        <div class="contact-pill d-flex align-items-center p-3 shadow-sm">
            <img src="images/profile3.jpg" class="profile-img me-3" alt="Maya Patel" />
            <div>
                <h5 class="mb-1">Maya Patel</h5>
                <p class="mb-0 text-muted">Esthetician</p>
                <p class="mb-0"><strong>Email:</strong> maya@fargospringsspa.com</p>
            </div>
        </div>
    </div>

    <section class="contact-pill p-4 shadow-sm mb-5">
        <h3 class="h4 mb-3 text-center">Send us a message</h3>

        @if (submitted)
        {
            <div class="alert alert-success shadow-sm" role="alert">
                @submitMessage
            </div>
        }

        <EditForm Model="@form" OnValidSubmit="@HandleValidSubmit" FormName="ContactForm">
            <DataAnnotationsValidator />
            <ValidationSummary class="text-danger mb-3" />

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <InputText class="form-control" @bind-Value="form.Name" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <InputText class="form-control" @bind-Value="form.Email" />
                </div>
                <div class="col-12">
                    <label class="form-label">Subject</label>
                    <InputText class="form-control" @bind-Value="form.Subject" />
                </div>
                <div class="col-12">
                    <label class="form-label">Message</label>
                    <InputTextArea class="form-control" @bind-Value="form.Message" rows="5" />
                </div>
                <div class="col-12 text-center">
                    <button type="submit" class="btn btn-primary shadow btn-lg">Send Message</button>
                </div>
            </div>
        </EditForm>
    </section>

    <section class="contact-pill p-4 shadow-sm">
        <h3 class="h4 mb-3 text-center">Find Us</h3>

        <div class="map-container shadow-sm">
            <iframe width="100%"
                    height="100%"
                    style="border:0;"
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    src="https://www.google.com/maps?q=Fargo%20Springs%20Spa%20Fargo%20ND&output=embed">
            </iframe>
        </div>

        <div class="text-center mt-3">
            <a class="btn btn-primary shadow btn-lg"
               href="https://www.google.com/maps/dir/?api=1&destination=Fargo+Springs+Spa+Fargo+ND"
               target="_blank" rel="noopener">
                Get Directions
            </a>
        </div>
    </section>
</div>

@code {
    private bool submitted = false;
    private string submitMessage = string.Empty;

    private ContactForm form = new();

    private async Task HandleValidSubmit()
    {
        using var db = await DbFactory.CreateDbContextAsync();

        var entity = new ContactMessage
        {
            Name = form.Name,
            Email = form.Email,
            Subject = form.Subject,
            Message = form.Message,
            CreatedAtUtc = DateTime.UtcNow
        };

        db.ContactMessages.Add(entity);
        await db.SaveChangesAsync();

        submitted = true;
        submitMessage = "Thanks. Your message was sent. We will get back to you soon.";
        form = new ContactForm();
        StateHasChanged();
    }

    public class ContactForm
    {
        [Required, StringLength(80)]
        public string Name { get; set; } = string.Empty;

        [Required, EmailAddress, StringLength(120)]
        public string Email { get; set; } = string.Empty;

        [Required, StringLength(120)]
        public string Subject { get; set; } = string.Empty;

        [Required, StringLength(2000, MinimumLength = 10)]
        public string Message { get; set; } = string.Empty;
    }
}
